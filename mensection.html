<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Men's Section - Trendify</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
   
<header class="header">
  <div class="alert">
    <div class="container">
      <p class="alert-text">FREE SHIPPING ON ORDERS ABOVE 1000</p>
    </div>
  </div>

  <div class="header-top" data-header>
    <div class="container">
      <button class="nav-open-btn" aria-label="open menu" data-nav-toggler>
        <span class="line line-1"></span>
        <span class="line line-2"></span>
        <span class="line line-3"></span>
      </button>

      <a href="index.html" class="logo">
        <img src="assets/logoletter.png" width="100" height="18" alt="ADORA">
      </a>

      <div class="header-actions">
        <button class="header-action-btn" aria-label="user" id="profile-btn">
          <ion-icon name="person-outline" aria-hidden="true"></ion-icon>
          <span class="profile-initial" id="profileInitial" style="display: none; position: absolute; top: -5px; right: -5px; background: #5a36a8; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; display: flex; align-items: center; justify-content: center;"></span>
        </button>

        <button class="header-action-btn" aria-label="cart item" id="cart-btn">
          <ion-icon name="bag-handle-outline" aria-hidden="true"></ion-icon>
          <span class="btn-badge" id="cart-count">0</span>
        </button>
      </div>

      <nav class="navbar">
        <ul class="navbar-list">
          <li><a href="index.html" class="navbar-link has-after">Home</a></li>
          <li><a href="men.html" class="navbar-link has-after">Men</a></li>
          <li><a href="women.html" class="navbar-link has-after">Women</a></li>
          <li><a href="blog.html" class="navbar-link has-after">Blog</a></li>
          <li><a href="profile.html" class="navbar-link has-after" id="profile-link">Profile</a></li>
        </ul>
      </nav>
    </div>
  </div>
</header>

<h1 style="color:black; text-align:center">Men's Section</h1>
<div class="container">
  <section id="college-outfits" class="product-section">
    <h2>Formals</h2>
    <div class="product-grid"></div>
  </section>

  <section id="trendy-outfits" class="product-section">
    <h2>Festive Outfits</h2>
    <div class="product-grid"></div>
  </section>

  <section id="casual-outfits" class="product-section">
    <h2>Casual Outfits</h2>
    <div class="product-grid"></div>
  </section>
</div>

<footer class="footer">
  <div class="footer-container">
    <div class="footer-section">
      <h3>About Us</h3>
      <ul>
        <li><a href="#">Our Story</a></li>
        <li><a href="#">Team</a></li>
        <li><a href="#">Careers</a></li>
      </ul>
    </div>
    <div class="footer-section">
      <h3>Customer Service</h3>
      <ul>
        <li><a href="#">Contact Us</a></li>
        <li><a href="#">FAQs</a></li>
        <li><a href="#">Shipping</a></li>
        <li><a href="#">Returns</a></li>
      </ul>
    </div>
    <div class="footer-section">
      <h3>Quick Links</h3>
      <ul>
        <li><a href="#">Home</a></li>
        <li><a href="#">Shop</a></li>
        <li><a href="#">Blog</a></li>
        <li><a href="#">Privacy Policy</a></li>
      </ul>
    </div>
    <div class="footer-section">
      <h3>Connect With Us</h3>
      <div class="social-icons">
        <a href="#"><i class="fab fa-facebook"></i></a>
        <a href="#"><i class="fab fa-twitter"></i></a>
        <a href="#"><i class="fab fa-instagram"></i></a>
        <a href="#"><i class="fab fa-pinterest"></i></a>
      </div>
    </div>
  </div>
  <div class="footer-bottom">
    <p>&copy; 2023 Your Company Name. All rights reserved.</p>
  </div>
</footer>

<script>
  // Check authentication status for profile and cart buttons
  async function checkAuthAndSetup() {
    const token = localStorage.getItem('token');
    const profileBtn = document.getElementById('profile-btn');
    const profileInitial = document.getElementById('profileInitial');

    if (token) {
      try {
        const response = await fetch('https://adora-t8e8.onrender.com/api/user/profile', {
          headers: { 'Auth': token }
        });
        const data = await response.json();

        if (data.user) {
          profileInitial.style.display = 'flex';
          profileInitial.textContent = data.user.name[0].toUpperCase();
          profileBtn.onclick = () => window.location.href = 'profile.html';
        } else {
          throw new Error('User not found');
        }
      } catch (error) {
        console.error('Error verifying user:', error);
        localStorage.removeItem('token');
        profileInitial.style.display = 'none';
        profileBtn.onclick = () => window.location.href = 'login.html';
      }
    } else {
      profileInitial.style.display = 'none';
      profileBtn.onclick = () => window.location.href = 'login.html';
    }
  }

  // Fetch and display products
  async function fetchAndDisplayProducts() {
    try {
      const response = await fetch('https://adora-t8e8.onrender.com/api/product/all');
      const { products } = await response.json();

      const collegeOutfits = document.querySelector('#college-outfits .product-grid');
      const trendyOutfits = document.querySelector('#trendy-outfits .product-grid');
      const casualOutfits = document.querySelector('#casual-outfits .product-grid');

      products.forEach(product => {
        if (product.category === 'mensection') {
          const productCard = `
            <div class="product-card">
              <img src="${product.imgSrc}" alt="${product.title}" class="product-image">
              <div class="product-info">
                <h3 class="product-title">${product.title}</h3>
                <p class="product-price">â‚¹${product.price.toFixed(2)}</p>
                <p class="product-description">${product.description}</p>
                <button class="btn-add-to-cart" data-product-id="${product._id}">Add to Cart</button>
              </div>
            </div>
          `;

          switch (product.type) {
            case 'formals': collegeOutfits.innerHTML += productCard; break;
            case 'festives': trendyOutfits.innerHTML += productCard; break;
            case 'casuals': casualOutfits.innerHTML += productCard; break;
          }
        }
      });

      // Add event listeners for add-to-cart buttons
      document.querySelectorAll('.btn-add-to-cart').forEach(button => {
        button.addEventListener('click', async (e) => {
          const productId = e.target.getAttribute('data-product-id');

          // Check if user is logged in
          const token = localStorage.getItem('token');
          if (!token) {
            alert('Please login first!');
            window.location.href = 'login.html';
            return;
          }

          try {
            const cartResponse = await fetch('https://adora-t8e8.onrender.com/api/cart/add', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Auth': token
              },
              body: JSON.stringify({ productId })
            });

            const cartData = await cartResponse.json();
            if (cartData.success) {
              updateCartDisplay();
              alert('Product added to cart successfully!');
            } else {
              alert(cartData.message || 'Failed to add product to cart.');
            }
          } catch (error) {
            console.error('Error adding to cart:', error);
            alert('An error occurred. Please try again.');
          }
        });
      });
    } catch (error) {
      console.error('Error fetching products:', error);
    }
  }

  // Update cart count
  function updateCartDisplay() {
    const cartCount = document.getElementById('cart-count');
    fetch('https://adora-t8e8.onrender.com/api/cart', {
      headers: { 'Auth': localStorage.getItem('token') }
    })
      .then(res => res.json())
      .then(data => {
        cartCount.textContent = data.cartItems.length || 0;
      })
      .catch(err => console.error('Error fetching cart data:', err));
  }

  // Initialize
  document.addEventListener('DOMContentLoaded', async () => {
    await checkAuthAndSetup();
    await fetchAndDisplayProducts();
    updateCartDisplay();
  });
</script>

</body>
</html>
